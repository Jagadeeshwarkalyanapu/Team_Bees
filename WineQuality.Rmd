---
title: "Wine Quality Prediction"
author: "Tanmay Ambegaokar, Bhuimka Mallikarjun , Kundana Chowdary Cherukuri, Jagadeeshwar Kalyanapu"
date: "`r Sys.Date()`"
# date: ""
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
library(tidyverse) 
library(dplyr)
library(ggplot2)
library(gridExtra)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```


# WINE!!!

Through this project we embark on an exhilarating journey through the world of wine, where we explore the delicate art of predicting wine quality. With each sip and swirl, we delve into the enchanting realm of data analysis and visualization, uncovering the hidden gems within the chemical attributes that define wine excellence. 


**Loading the Dataset**
```{r load, include=TRUE, results='asis'}

wine=read.csv("winequalityN.csv")
xkabledplyhead(wine)
xkabledplytail(wine)
str(wine)
```



We have succesfully loaded the dataset. We can see that there are 6497 observations and 13 variables. Next lets look at the summary statistics. 

**SUMMARY STATISTICS**
```{r summary, include=TRUE, results='asis'}
xkablesummary(wine)
```

A quick look at the summary tells us the inter-quartile ranges and maximum and minimum values for each variable.

*Observations*

2) There are also some NA values which we need to remove.
3) There might be duplicates in the dataset.

**CLEANING THE DATA**

**Removing Duplicates**
```{r cleanduplicates, include=TRUE, results='asis'}
wine <- unique(wine)
str(wine)
```

Duplicates can cause issues later with biases. Thus, we have removed the duplicate values. Now, the dataset has 5329 observations.

**Removing NAs**
```{r removeNA, include=TRUE, results='asis'}
wine <- na.omit(wine)
str(wine)
xkablesummary(wine)
```


After, removing the NAs, we are finally left with 5295 observations. The dataset is now clean.

Now, the data is clean. We have NAs, and duplicates. We can now start our exploratory data analysis. 

*Observations*

1) There is a big difference between maximum value and Q3 values. This means that there are a quite a lot of outliers. Let's visualize this using plots.


## UNIVARIATE PLOTS

To understand in depth as to which factor effects the quality the most, let's understand the individual variables in the data set.

```{r quality , include=TRUE, results='asis'}
ggplot(data = wine, aes(x = quality)) +
  geom_bar(width = 0.8, color = 'black', fill = I('red')) +
  labs(
    title = "Overall Wine Quality",
    x = "Quality",
    y = "Count"
  )
```


Wine quality shows a rather symmetrical distribution. 
Most wines have a quality score of 6. 
No wine achieved the highest score of 10 and the worst wines got a rating of 3. 

Let's see how the other factors are effecting!

```{r univariate1, include=TRUE, results='asis'}
p1 <- ggplot(data = wine, aes(x = citric.acid)) +
  geom_bar(fill = I('blue')) +
  labs(
    title = "Citric Acidity",
    x = "Concentration [g/L]",
    y = "Count"
  )

p2 <- ggplot(data = wine, aes(x = pH)) +
  geom_bar( fill = I('blue')) +
  labs(
    title = "pH",
    x = "pH",
    y = "Count"
  )
p3 <- ggplot(data = wine, aes(x = residual.sugar)) +
  geom_histogram(binwidth = 1,  fill = I('blue')) +
  labs(
    title = "Residual Sugar",
    x = "Residual Sugar (g/L)",
    y = "Count"
  )
p4 <- ggplot(data = wine, aes(x = density)) +
  geom_histogram(binwidth = 0.002,  fill = I('blue')) +
  labs(
    title = "Density",
    x = "Density",
    y = "Count"
  )
p5 <- ggplot(data = wine, aes(x = chlorides)) +
  geom_histogram(binwidth = 0.005,  fill = I('blue')) +
  labs(
    title = "Chlorides",
    x = "Chloride Content (g/L)",
    y = "Count"
  )
p6 <-  ggplot(data = wine, aes(x = alcohol)) +
  geom_histogram(binwidth = 1,  fill = I('blue')) +
  labs(
    title = "Alcohol Content",
    x = "Alcohol Content (% by volume)",
    y = "Count"
  )
grid.arrange(p1,p2,p3,p4,p5,p6, nrow = 3)
```


```{r univariate2, include=TRUE, results='asis'}
p7 <- ggplot(data = wine, aes(x = fixed.acidity)) +
  geom_bar( fill = I('blue')) +
  labs(
    title = "Fixed Acidity",
    x = "TaOH Concentration [g/L]",
    y = "Count"
  )

 p8 <- ggplot(data = wine, aes(x = volatile.acidity)) +
  geom_bar(  fill = I('blue')) +
  labs(
    title = "Volatile Acidity",
    x = "AcOH Concentration [g/L]",
    y = "Count"
  )
 
 p9 <- ggplot(wine, aes(x = free.sulfur.dioxide)) +
  geom_histogram(binwidth = 5,  fill = I('blue')) +
  labs(
    title = "Free Sulfur Dioxide Concentration",
    x = "Concentration (mg/L)",
    y = "Frequency"
  )

 p10 <- ggplot(wine, aes(x = total.sulfur.dioxide)) +
  geom_histogram(binwidth = 20, fill = "blue") +
  labs(
    title = "Total Sulfur Dioxide Concentration",
    x = "Concentration (mg/L)",
    y = "Frequency"
  )

grid.arrange(p7,p8, p9,p10, nrow = 2)

```

*Observations:*

1) Most distributions encountered during the exploration of the parameters looked rather usual. In general, they were positively skewed with a narrow main peak.

We will also have a look at at the box plots for these!

```{r boxplots, include=TRUE, results='asis'}
p1 <- ggplot(data = wine, aes(x = "", y = fixed.acidity )) +
  geom_boxplot(color = 'black', fill = I('white')) +
  labs(
    x = "Fixed Acidity",
    y = "TaOH Concentration [g/L]"
  )

p2 <- ggplot(data = wine, aes(x = "", y = volatile.acidity)) +
  geom_boxplot(color = 'black', fill = I('white')) +
  labs(
    x = "Volatile Acidity",
    y = "AcOH Concentration [g/L]"
  )

 p3 <- ggplot(data = wine, aes(x = "", y = citric.acid)) +
  geom_boxplot(color = 'black', fill = I('white')) +
  labs(
    x = "Citric Acidity",
    y = "Concentration [g/L]"
  )

 p4 <- ggplot(data = wine, aes(x = "", y = pH))+
  geom_boxplot(color = 'black', fill = I('white')) +
  labs(
    x = "pH",
    y = "pH"
  )
grid.arrange(p1,p2, p3,p4, nrow = 1)
```


**Observations**
1) Residual sugar has a very long-tail distribution with many outliers. It will be interesting to see how these outliers affect the quality of wine.
2) Chlorides have distribution similar to residual sugar and have a strong concentration around the median. We also note a lot of outliers from the box plot.
3) Most wines have less than 11% alcohol.
4) Density has a very normal looking distribution with most of the values falling between 0.995 and 1.


**SUMMARY FROM UNIVARIATE PLOTS**
1)  In general, the variables were positively skewed with a narrow main peak.
2) Most wines have a pH of 3.2. Since we have chlorides,citric acid, and fixed and volatile acidity, the wines were bound to be on the acidic side.
3) The wines have an alcohol content ranging between 8 and 15 vol%.


**BIVARIATE PLOTS**

First, we will build correlation matrix to identify the variables which influence quality the most. 
```{r cor, results='asis'}

numeric_data <- subset(wine, select = -c(type))
redd <- subset(wine, type == "red")
numeric_datared <- subset(redd, select = -c(type))
whited <- subset(wine, type == "white")
numeric_datawhite <- subset(whited, select = -c(type))
loadPkg("corrplot")
cor_matrix <-cor(numeric_data)
corrplot(cor_matrix, method="circle",type="upper")
numeric_data <- subset(wine, select = -c(type))


```


**Observations**
Our Target Variable is Quality, so we will focus on only those parameters which influence quality.

1) Alcohol and quality have a high positive correlation.
2) Density and quality have a negative correlation.
3) Low correlation between quality and chloride concentration
4) Wine quality also slightly negatively correlates with volatile acidity.
5) It has a slight positive correlation with citric acid.

From the correlation matrix, let us now see how these parameters vary over different quality ratings.

**ALCOHOL VS QUALITY**
```{r alcqual, results='asis'}
library(ggplot2)
ggplot(wine, aes(x = as.factor(quality), y = alcohol)) +
  geom_boxplot(fill = "brown", color = "darkblue") +
  labs(x = "Wine Quality", y = "Alcohol") +
  ggtitle("Box Plot of Alcohol vs Quality")
```


##Subset the dataset into red and white wines

```{r subsetting, include=TRUE, results='asis'}
# Subset the dataset into red and white wines
red_wines <- wine[wine$type == "red", ]
white_wines <- wine[wine$type == "white", ]
```

This code will generate two new data frames, red_wines and white_wines, each containing observations from the original dataset with the "type" column set to "red" or "white," as appropriate.


The boxplot shows that wines with higher quality seem to have a higher alcohol content. Let us check how it varies for red and white wine

```{r colalc,results='asis'}
library(ggplot2)
red <- subset(wine, type == "red")
white <- subset(wine, type == "white")
ggplot() +
  
  geom_boxplot(data = red, aes(x = as.factor(quality), y = alcohol, fill = "red"), width = 0.4) +
  labs(x = "Wine Quality", y = "Alcohol", fill = "Wine Color") +
  ggtitle("Box Plot of Alcohol vs Quality for Red Wines") +
  scale_fill_manual(values = c("red" = "red"))

ggplot() +
  geom_boxplot(data = white, aes(x = as.factor(quality), y = alcohol, fill = "white"), width = 0.4) +
  labs(x = "Wine Quality", y = "Alcohol", fill = "Wine Color") +
  ggtitle("Box Plot of Alcohol vs Quality for White Wines") +
  scale_fill_manual(values = c("white" = "white"))
```

**DENSITY VS QUALITY**
```{r alcqual, results='asis'}
library(ggplot2)
# Density Distribution by Wine Quality
ggplot(wine, aes(x = factor(quality), y = density)) +
  geom_boxplot(fill = "lightblue") +
  labs(x = "Quality", y = "Density") +
  ggtitle("Density Distribution by Wine Quality")
  ylim(0, 1.01)  # Adjust the limits as needed

```
